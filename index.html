<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°</title>

<style>
:root {
  --bg:#f5f6f7;
  --card:#ffffff;
  --text:#222;
  --accent:#2563eb;
  --notice-bg:#fde68a;
  --notice-text:#000;
}
body.dark {
  --bg:#121212;
  --card:#1e1e1e;
  --text:#f1f1f1;
  --notice-bg:#3f3f46;
  --notice-text:#facc15;
}

body {
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header {
  background:#2563eb;
  color:#fff;
  padding:14px 20px;
  font-size:20px;
  display:flex;
  justify-content:space-between;
}

.container {
  max-width:1100px;
  margin:20px auto;
  padding:0 12px;
}

.grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}

.card {
  background:var(--card);
  border-radius:12px;
  padding:18px;
}

input {
  padding:12px;
  font-size:15px;
}

button { cursor:pointer; }

.badge {
  display:inline-block;
  padding:8px 18px;
  border-radius:999px;
  font-size:15px;
  font-weight:700;
  color:#fff;
}

.badge-ë¸Œë¡ ì¦ˆ {background:#cd7f32;}
.badge-ì‹¤ë²„ {background:#9ca3af;}
.badge-ê³¨ë“œ {background:#facc15;color:#000;}
.badge-ë‹¤ì´ì•„ {background:#38bdf8;}
.badge-ë ˆë“œ {background:#ef4444;}
.badge-ë¸”ë™ {background:#000;}

.target-btn {
  width:100%;
  max-width:110px;
  padding:10px;
  margin:4px;
  border:none;
  border-radius:999px;
  font-weight:700;
  color:#fff;
}

.notice {
  margin:12px 0;
  padding:12px;
  border-radius:10px;
  background:var(--notice-bg);
  color:var(--notice-text);
  font-weight:700;
}

.highlight-amount {
  font-size:20px;
  font-weight:800;
  color:var(--accent);
}

.time-highlight {
  font-weight:800;
  color:#ef4444;
}

table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td {
  padding:10px;
  border-bottom:1px solid #ccc;
  text-align:center;
}
</style>
</head>

<body>
<header>
  ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°
  <button onclick="document.body.classList.toggle('dark')">ğŸŒ™/â˜€ï¸</button>
</header>

<div class="container">

<div class="grid">

<div class="card">
  <h3>ì¶©ì „ ê¸°ë¡ ì¶”ê°€</h3>
  <input type="date" id="dateInput">
  <input type="number" id="amountInput" placeholder="ê¸ˆì•¡ (ì›)">
  <button onclick="addRecord()">ì¶”ê°€</button>
  <button onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>

  <div class="notice">
    âš ï¸ ìºì‹œ ì¶©ì „ ê¸ˆì•¡ì´ ì•„ë‹Œ <b>ìºì‹œ ì‚¬ìš© ë‚ ì§œ</b>ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.
  </div>

  <h4>ì¶©ì „ ê¸°ë¡</h4>
  <table>
    <thead><tr><th>ë‚ ì§œ</th><th>ê¸ˆì•¡</th><th>ì‚­ì œ</th></tr></thead>
    <tbody id="recordTable"></tbody>
  </table>

  <h4>ëª©í‘œ MVP ë“±ê¸‰</h4>
  <div id="targetButtons"></div>
</div>

<div class="card">
  <h3>ğŸ“Œ ìš”ì•½ ì •ë³´</h3>

  <p>í˜„ì¬ ë“±ê¸‰ : <span id="currentBadge"></span></p>
  <p>ëª©í‘œ ë“±ê¸‰ : <span id="targetBadge"></span></p>

  <p>
    ìµœê·¼ 13ì£¼ ëˆ„ì  :
    <span id="totalText" class="highlight-amount"></span>
  </p>

  <p id="goalText"></p>
</div>

</div>

<div class="card">
  <h3>ğŸ“Š ì£¼ì°¨ë³„ ì˜ˆìƒ ë“±ê¸‰ ì‹œë®¬ë ˆì´ì…˜ (13ì£¼)</h3>
  <table>
    <thead>
      <tr><th>ê¸°ì¤€ ë‚ ì§œ(ëª©)</th><th>ëˆ„ì </th><th>ë“±ê¸‰</th></tr>
    </thead>
    <tbody id="weekTable"></tbody>
  </table>
</div>

</div>

<script>
const MVP=[
  {name:"ë¸Œë¡ ì¦ˆ",min:150000},
  {name:"ì‹¤ë²„",min:300000},
  {name:"ê³¨ë“œ",min:600000},
  {name:"ë‹¤ì´ì•„",min:900000},
  {name:"ë ˆë“œ",min:1500000},
  {name:"ë¸”ë™",min:3000000}
];

let records=[];
let target="ë ˆë“œ";

/* âœ… í•­ìƒ ê°€ì¥ ìµœê·¼ì— ì§€ë‚œ ëª©ìš”ì¼ (í•œêµ­ ì‹œê°„ ê¸°ì¤€) */
function getLastThursday(base=new Date()){
  const d=new Date(base);
  d.setHours(12,0,0,0); // ë‚ ì§œ ë°€ë¦¼ ë°©ì§€
  const day=d.getDay(); // 0~6
  const diff = day >= 4 ? day - 4 : day + 3;
  d.setDate(d.getDate() - diff);
  d.setHours(0,0,0,0);
  return d;
}

function gradeByAmount(a){
  let g=null;
  for(const m of MVP) if(a>=m.min) g=m;
  return g;
}

function calc13WeeksTotal(base){
  const s=new Date(base);
  s.setDate(s.getDate()-7*12);
  return records.filter(r=>{
    const d=new Date(r.date);
    return d>=s && d<=base;
  }).reduce((t,r)=>t+r.amount,0);
}

function addRecord(){
  if(!dateInput.value||!amountInput.value) return;
  records.push({date:dateInput.value,amount:+amountInput.value});
  update();
}
function resetAll(){records=[];update();}

function update(){
  recordTable.innerHTML="";
  records.sort((a,b)=>new Date(b.date)-new Date(a.date));
  records.forEach((r,i)=>{
    recordTable.innerHTML+=`
    <tr>
      <td>${r.date}</td>
      <td>${r.amount.toLocaleString()}</td>
      <td><button onclick="records.splice(${i},1);update()">X</button></td>
    </tr>`;
  });

  targetButtons.innerHTML="";
  MVP.forEach(m=>{
    targetButtons.innerHTML+=`
      <button class="target-btn badge-${m.name}"
        onclick="target='${m.name}';update()">${m.name}</button>`;
  });

  const now=new Date();
  now.setHours(23,59,59,999);

  const base=getLastThursday(now);
  const total=calc13WeeksTotal(now);

  const cur=gradeByAmount(total);
  const tar=MVP.find(m=>m.name===target);

  currentBadge.innerHTML=cur
    ? `<span class="badge badge-${cur.name}">${cur.name}</span>`
    : `ì—†ìŒ`;

  targetBadge.innerHTML=
    `<span class="badge badge-${tar.name}">${tar.name}</span>`;

  totalText.innerText=total.toLocaleString()+"ì›";

  weekTable.innerHTML="";
  let breakDate=null;

  for(let i=0;i<13;i++){
    const d=new Date(base);
    d.setDate(d.getDate()+7*i);
    const sum=calc13WeeksTotal(d);
    const g=gradeByAmount(sum);
    if(!breakDate && sum<tar.min) breakDate=d;

    weekTable.innerHTML+=`
    <tr>
      <td>${d.toISOString().slice(0,10)}</td>
      <td>${sum.toLocaleString()}</td>
      <td>${g?g.name:"ì—†ìŒ"}</td>
    </tr>`;
  }

  if(total < tar.min){
    goalText.innerHTML=
      `âŒ ëª©í‘œ ë¯¸ë‹¬<br>
       ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ ${(tar.min-total).toLocaleString()}ì› í•„ìš”`;
  } else if(breakDate){
    const limit=new Date(breakDate);
    limit.setDate(limit.getDate()-1);
    goalText.innerHTML=
      `${limit.toISOString().slice(0,10)}
       <span class="time-highlight">23:59</span>ê¹Œì§€ ì‚¬ìš© ê°€ëŠ¥<br>
       ì´í›„ ìœ ì§€ë¥¼ ìœ„í•´ ${(tar.min-calc13WeeksTotal(breakDate)).toLocaleString()}ì› í•„ìš”`;
  } else {
    goalText.innerHTML="ê³„ì† ìœ ì§€ ê°€ëŠ¥";
  }
}

update();
</script>
</body>
</html>
