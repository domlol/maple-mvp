<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --bg: #f5f7fa;
  --card: #ffffff;
  --text: #222;
  --sub: #666;
  --border: #ddd;
  --primary: #2563eb;
}
.dark {
  --bg: #121212;
  --card: #1e1e1e;
  --text: #eee;
  --sub: #aaa;
  --border: #333;
  --primary: #3b82f6;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: var(--bg);
  color: var(--text);
}

header {
  background: var(--primary);
  color: #fff;
  padding: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

button {
  cursor: pointer;
  border: none;
  border-radius: 6px;
  padding: 6px 12px;
}

.container {
  max-width: 1100px;
  margin: 20px auto;
  padding: 0 12px;
}

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.card {
  background: var(--card);
  border-radius: 12px;
  padding: 16px;
}

input {
  width: 100%;
  box-sizing: border-box;
  padding: 8px;
  margin-top: 4px;
  margin-bottom: 8px;
}

.notice {
  font-size: 12px;
  color: #f97316;
}

.badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  color: #fff;
  font-size: 12px;
}

.mvp-btns button {
  margin: 4px 4px 0 0;
}

.selected {
  outline: 2px solid #000;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 8px;
}
th, td {
  border-bottom: 1px solid var(--border);
  padding: 6px;
  text-align: center;
}
</style>
</head>

<body>
<header>
  <h2>ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°</h2>
  <button id="modeBtn">ë‹¤í¬ / ë¼ì´íŠ¸</button>
</header>

<div class="container">

<div class="grid">
<!-- ì™¼ìª½ -->
<div class="card">
<h3>ì¶©ì „ ê¸°ë¡ ì¶”ê°€</h3>
<label>ìºì‹œ ì‚¬ìš© ë‚ ì§œ</label>
<input type="date" id="dateInput">
<label>ê¸ˆì•¡</label>
<input type="number" id="amountInput">
<button onclick="addRecord()">ì¶”ê°€</button>
<button onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>

<p class="notice">âš  MVP ê³„ì‚°ì€ ìºì‹œ ì¶©ì „ì¼ì´ ì•„ë‹Œ ì‹¤ì œ ìºì‹œ ì‚¬ìš© ë‚ ì§œ ê¸°ì¤€ì…ë‹ˆë‹¤.</p>

<h3>ì¶©ì „ ê¸°ë¡</h3>
<table>
<thead><tr><th>ë‚ ì§œ</th><th>ê¸ˆì•¡</th><th>ì‚­ì œ</th></tr></thead>
<tbody id="recordBody"></tbody>
</table>

<h3>ëª©í‘œ MVP ë“±ê¸‰</h3>
<div class="mvp-btns" id="targetBtns"></div>
</div>

<!-- ì˜¤ë¥¸ìª½ -->
<div class="card">
<h3>ğŸ“Œ ìš”ì•½ ì •ë³´</h3>
<div id="summary"></div>
</div>
</div>

<div class="card" style="margin-top:16px;">
<h3>ğŸ“Š ì£¼ì°¨ë³„ ì˜ˆìƒ ë“±ê¸‰ ì‹œë®¬ë ˆì´ì…˜ (13ì£¼)</h3>
<table>
<thead><tr><th>ê¸°ì¤€ ë‚ ì§œ (ëª©)</th><th>ì˜ˆìƒ ëˆ„ì </th><th>ë“±ê¸‰</th></tr></thead>
<tbody id="simBody"></tbody>
</table>
</div>

</div>

<script>
/* ================== ì„¤ì • ================== */
const MVP = [
  {name:'ë¸Œë¡ ì¦ˆ', v:15, c:'#92400e'},
  {name:'ì‹¤ë²„', v:30, c:'#6b7280'},
  {name:'ê³¨ë“œ', v:60, c:'#d97706'},
  {name:'ë‹¤ì´ì•„', v:90, c:'#22d3ee'},
  {name:'ë ˆë“œ', v:150, c:'#ef4444'},
  {name:'ë¸”ë™', v:300, c:'#000000'}
];

let records = [];
let target = null;

/* ================== UI ================== */
document.getElementById('modeBtn').onclick=()=>{
  document.body.classList.toggle('dark');
};

const targetBtns = document.getElementById('targetBtns');
MVP.forEach(m=>{
  const b=document.createElement('button');
  b.textContent=m.name;
  b.onclick=()=>{
    target=m;
    [...targetBtns.children].forEach(x=>x.classList.remove('selected'));
    b.classList.add('selected');
    render();
  };
  targetBtns.appendChild(b);
});

/* ================== ë¡œì§ ================== */
function addRecord(){
  const d=dateInput.value;
  const a=+amountInput.value;
  if(!d||!a)return;
  records.push({d,newDate:new Date(d),a});
  render();
}

function resetAll(){
  records=[];
  target=null;
  [...targetBtns.children].forEach(x=>x.classList.remove('selected'));
  render();
}

function get13WeekSum(base){
  const from=new Date(base);
  from.setDate(from.getDate()-91);
  return records.filter(r=>r.newDate>=from&&r.newDate<=base)
    .reduce((s,r)=>s+r.a,0);
}

function getGrade(sum){
  let g=null;
  MVP.forEach(m=>{
    if(sum>=m.v*10000) g=m;
  });
  return g;
}

function nextWed13(base){
  const d=new Date(base);
  d.setDate(d.getDate()+91);
  d.setDate(d.getDate()+(3-d.getDay()+7)%7);
  return d;
}

function render(){
  recordBody.innerHTML='';
  records.sort((a,b)=>b.newDate-a.newDate).forEach((r,i)=>{
    recordBody.innerHTML+=`
    <tr>
      <td>${r.d}</td>
      <td>${r.a.toLocaleString()}</td>
      <td><button onclick="records.splice(${i},1);render()">X</button></td>
    </tr>`;
  });

  const now=new Date();
  const sum=get13WeekSum(now);
  const grade=getGrade(sum);

  summary.innerHTML='';
  if(grade){
    summary.innerHTML+=`
    í˜„ì¬ ë“±ê¸‰: <span class="badge" style="background:${grade.c}">${grade.name}</span><br>
    ìµœê·¼ 13ì£¼ ëˆ„ì : ${sum.toLocaleString()}ì›<br>`;
  } else {
    summary.innerHTML+=`í˜„ì¬ ë“±ê¸‰: ì—†ìŒ<br>ìµœê·¼ 13ì£¼ ëˆ„ì : ${sum.toLocaleString()}ì›<br>`;
  }

  if(target){
    if(sum>=target.v*10000){
      summary.innerHTML+=`
      ëª©í‘œ ë‹¬ì„± <span class="badge" style="background:${target.c}">${target.name}</span><br>
      ${nextWed13(now).toISOString().slice(0,10)} ê¹Œì§€ ìœ ì§€`;
    } else {
      summary.innerHTML+=`
      ${target.name}ê¹Œì§€ ${(target.v*10000-sum).toLocaleString()}ì› ë¶€ì¡±`;
    }
  }

  simBody.innerHTML='';
  let th=new Date();
  th.setDate(th.getDate()+(4-th.getDay()+7)%7);
  for(let i=0;i<13;i++){
    const s=get13WeekSum(th);
    const g=getGrade(s);
    simBody.innerHTML+=`
    <tr>
      <td>${th.toISOString().slice(0,10)}</td>
      <td>${s.toLocaleString()}</td>
      <td>${g?g.name:'ì—†ìŒ'}</td>
    </tr>`;
    th.setDate(th.getDate()+7);
  }
}

render();
</script>
</body>
</html>
