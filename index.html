<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°</title>

<style>
:root{
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#111;
  --sub:#666;
  --line:#e5e7eb;
}

[data-theme="dark"]{
  --bg:#0f1115;
  --card:#1c1f26;
  --text:#f1f1f1;
  --sub:#aaa;
  --line:#333;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui, sans-serif;
}

header{
  background:#2563eb;
  color:#fff;
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:18px;
  font-weight:700;
}

.toggle-btn{
  background:#fff;
  border:none;
  border-radius:6px;
  padding:6px 10px;
  cursor:pointer;
}

.container{
  max-width:1100px;
  margin:20px auto;
  padding:0 16px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}

.card{
  background:var(--card);
  border-radius:12px;
  padding:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}

h3{
  margin:0 0 12px;
}

input{
  padding:8px;
}

button{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.add{background:#2563eb;color:#fff;}
.reset{background:#ef4444;color:#fff;}

.notice{
  margin:12px 0;
  padding:10px;
  background:#fff3cd;
  border-left:4px solid #f59e0b;
  font-size:14px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th,td{
  border-bottom:1px solid var(--line);
  padding:10px 8px;
  text-align:center;
}

.badge{
  padding:4px 10px;
  border-radius:999px;
  font-weight:700;
  font-size:13px;
  color:#fff;
}

.bronze{background:#cd7f32;}
.silver{background:#9ca3af;}
.gold{background:#facc15;color:#000;}
.diamond{background:#38bdf8;}
.red{background:#ef4444;}
.black{background:#000;}

.rank-select button{
  margin:4px;
}

.full{
  grid-column:1/-1;
}
</style>
</head>

<body data-theme="light">

<header>
  ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°
  <button class="toggle-btn" onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>
</header>

<div class="container">

  <div class="grid">
    <div class="card">
      <h3>ì¶©ì „ ê¸°ë¡ ì¶”ê°€</h3>
      <input type="date" id="date">
      <input type="number" id="amount" placeholder="ê¸ˆì•¡">
      <br><br>
      <button class="add" onclick="add()">ì¶”ê°€</button>
      <button class="reset" onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>

      <div class="notice">âš  MVP ê³„ì‚°ì€ ìºì‹œ ì¶©ì „ì¼ì´ ì•„ë‹Œ ì‹¤ì œ ìºì‹œ ì‚¬ìš© ë‚ ì§œ ê¸°ì¤€ì…ë‹ˆë‹¤.</div>

      <h4>ì¶©ì „ ê¸°ë¡</h4>
      <table>
        <thead>
          <tr><th>ë‚ ì§œ</th><th>ê¸ˆì•¡</th><th>ì‚­ì œ</th></tr>
        </thead>
        <tbody id="list"></tbody>
      </table>

      <h4 style="margin-top:16px;">ëª©í‘œ MVP ë“±ê¸‰</h4>
      <div class="rank-select">
        <button class="badge bronze" onclick="setTarget('ë¸Œë¡ ì¦ˆ')">ë¸Œë¡ ì¦ˆ</button>
        <button class="badge silver" onclick="setTarget('ì‹¤ë²„')">ì‹¤ë²„</button>
        <button class="badge gold" onclick="setTarget('ê³¨ë“œ')">ê³¨ë“œ</button>
        <button class="badge diamond" onclick="setTarget('ë‹¤ì´ì•„')">ë‹¤ì´ì•„</button>
        <button class="badge red" onclick="setTarget('ë ˆë“œ')">ë ˆë“œ</button>
        <button class="badge black" onclick="setTarget('ë¸”ë™')">ë¸”ë™</button>
      </div>
    </div>

    <div class="card">
      <h3>ğŸ“Œ ìš”ì•½ ì •ë³´</h3>
      <div id="summary"></div>
    </div>

    <div class="card full">
      <h3>ğŸ“Š ì£¼ì°¨ë³„ ì˜ˆìƒ ë“±ê¸‰ ì‹œë®¬ë ˆì´ì…˜ (13ì£¼)</h3>
      <table>
        <thead>
          <tr><th>ê¸°ì¤€ ë‚ ì§œ (ëª©)</th><th>ëˆ„ì </th><th>ë“±ê¸‰</th></tr>
        </thead>
        <tbody id="weeks"></tbody>
      </table>
    </div>
  </div>

</div>

<script>
const ranks=[
 {n:'ë¸Œë¡ ì¦ˆ',v:0,c:'bronze'},
 {n:'ì‹¤ë²„',v:300000,c:'silver'},
 {n:'ê³¨ë“œ',v:1000000,c:'gold'},
 {n:'ë‹¤ì´ì•„',v:2000000,c:'diamond'},
 {n:'ë ˆë“œ',v:1500000,c:'red'},
 {n:'ë¸”ë™',v:3000000,c:'black'}
];

let data=JSON.parse(localStorage.getItem('data')||'[]');
let target=localStorage.getItem('target')||'ë ˆë“œ';

function toggleTheme(){
 const b=document.body;
 b.dataset.theme=b.dataset.theme==='dark'?'light':'dark';
 localStorage.setItem('theme',b.dataset.theme);
}

document.body.dataset.theme=localStorage.getItem('theme')||'light';

function add(){
 const d=date.value;
 const a=+amount.value;
 if(!d||!a) return;
 data.push({d,a});
 data.sort((x,y)=>new Date(y.d)-new Date(x.d));
 save();
}

function resetAll(){
 if(confirm('ì´ˆê¸°í™”?')){
  data=[];
  save();
 }
}

function del(i){
 data.splice(i,1);
 save();
}

function save(){
 localStorage.setItem('data',JSON.stringify(data));
 render();
}

function getThursday(base){
 const d=new Date(base);
 d.setDate(d.getDate()-((d.getDay()+3)%7));
 d.setHours(0,0,0,0);
 return d;
}

function sumUntil(date){
 const start=new Date(date);
 start.setDate(start.getDate()-90);
 return data.filter(x=>{
  const t=new Date(x.d);
  return t>=start && t<=date;
 }).reduce((s,x)=>s+x.a,0);
}

function rankBy(sum){
 return [...ranks].reverse().find(r=>sum>=r.v)||ranks[0];
}

function render(){
 list.innerHTML='';
 data.forEach((x,i)=>{
  list.innerHTML+=`
   <tr>
    <td>${x.d}</td>
    <td>${x.a.toLocaleString()}</td>
    <td><button onclick="del(${i})">X</button></td>
   </tr>`;
 });

 const nowThu=getThursday(new Date()-1);
 let rows='';
 let lastMaintain=null;

 for(let i=0;i<13;i++){
  const d=new Date(nowThu);
  d.setDate(d.getDate()+i*7);
  const sum=sumUntil(d);
  const r=rankBy(sum);
  if(r.n===target) lastMaintain=d;
  rows+=`
   <tr>
    <td>${d.toISOString().slice(0,10)}</td>
    <td>${sum.toLocaleString()}</td>
    <td>${r.n}</td>
   </tr>`;
 }

 weeks.innerHTML=rows;

 const nowSum=sumUntil(new Date());
 const cur=rankBy(nowSum);
 const tar=ranks.find(r=>r.n===target);

 let html=`
 í˜„ì¬ ë“±ê¸‰: <span class="badge ${cur.c}">${cur.n}</span><br><br>
 ìµœê·¼ 13ì£¼ ëˆ„ì : ${nowSum.toLocaleString()}ì›<br><br>
 ëª©í‘œ ë“±ê¸‰: <span class="badge ${tar.c}">${tar.n}</span><br><br>`;

 if(nowSum>=tar.v){
  html+=`âœ… ëª©í‘œ ë‹¬ì„±<br>${lastMaintain.toISOString().slice(0,10)}ê¹Œì§€ ìœ ì§€<br>
  ì´í›„ ìœ ì§€ë¥¼ ìœ„í•´ ${tar.v.toLocaleString()}ì› í•„ìš”`;
 }else{
  html+=`âŒ ëª©í‘œ ë¯¸ë‹¬<br>${(tar.v-nowSum).toLocaleString()}ì› ë” í•„ìš”`;
 }

 summary.innerHTML=html;
}

function setTarget(t){
 target=t;
 localStorage.setItem('target',t);
 render();
}

render();
</script>
</body>
</html>
