<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°</title>

<style>
:root {
  --bg: #f4f6f8;
  --card: #ffffff;
  --text: #000;
  --primary: #0d6efd;
  --danger: #dc3545;
}

body.dark {
  --bg: #121212;
  --card: #1e1e1e;
  --text: #eaeaea;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  background: var(--primary);
  color: white;
  padding: 12px;
  text-align: center;
  position: relative;
}

#themeToggle {
  position: absolute;
  right: 10px;
  top: 10px;
  width: 40px;
  height: 40px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

.container {
  max-width: 1100px;
  margin: 20px auto;
}

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.card {
  background: var(--card);
  border-radius: 12px;
  padding: 20px;
}

input {
  width: 100%;
  height: 48px;
  font-size: 16px;
  padding: 8px;
  margin-bottom: 10px;
}

button {
  padding: 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.btn-blue { background: var(--primary); color: white; }
.btn-red { background: var(--danger); color: white; }

.grade-btn {
  margin: 4px;
  width: 90px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  border-bottom: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}
</style>
</head>

<body>

<header>
  ğŸŒ™ ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°  
  <div>ì´ë²ˆ ì£¼ í¬í•¨ ìµœê·¼ 13ì£¼ êµ¬ë§¤ ê¸ˆì•¡ ê¸°ì¤€</div>
  <button id="themeToggle">ğŸŒ™</button>
</header>

<div class="container">

<div class="grid">
  <div class="card">
    <h3>ì¶©ì „ ê¸°ë¡ ì¶”ê°€</h3>
    <input type="date" id="chargeDate">
    <input type="number" id="chargeAmount" placeholder="ì¶©ì „ ê¸ˆì•¡">
    <button class="btn-blue" onclick="addCharge()">ì¶”ê°€í•˜ê¸°</button>
    <button class="btn-red" onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>

    <h3 style="margin-top:20px">ëª©í‘œ MVP ë“±ê¸‰</h3>
    <div>
      <button class="btn-blue grade-btn" onclick="setTarget('ë¸Œë¡ ì¦ˆ')">ë¸Œë¡ ì¦ˆ</button>
      <button class="btn-blue grade-btn" onclick="setTarget('ì‹¤ë²„')">ì‹¤ë²„</button>
      <button class="btn-blue grade-btn" onclick="setTarget('ê³¨ë“œ')">ê³¨ë“œ</button>
      <button class="btn-blue grade-btn" onclick="setTarget('ë‹¤ì´ì•„')">ë‹¤ì´ì•„</button>
      <button class="btn-blue grade-btn" onclick="setTarget('ë ˆë“œ')">ë ˆë“œ</button>
      <button class="btn-blue grade-btn" onclick="setTarget('ë¸”ë™')">ë¸”ë™</button>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ“Œ ìš”ì•½ ì •ë³´</h3>
    <div id="summary"></div>
    <hr>
    <h3>ğŸ“Œ ì¶©ì „ ì¶”ì²œ</h3>
    <div id="recommend"></div>
  </div>
</div>

<div class="card" style="margin-top:20px">
  <h3>ğŸ“Š ì£¼ì°¨ë³„ ì˜ˆìƒ ë“±ê¸‰ ì‹œë®¬ë ˆì´ì…˜ (ë‚ ì§œ ê¸°ì¤€)</h3>
  <table>
    <thead>
      <tr>
        <th>ê¸°ì¤€ ë‚ ì§œ</th>
        <th>ì˜ˆìƒ ëˆ„ì </th>
        <th>ì˜ˆìƒ ë“±ê¸‰</th>
      </tr>
    </thead>
    <tbody id="simulation"></tbody>
  </table>
</div>

<div class="card" style="margin-top:20px">
  <h3>ğŸ§¾ ì¶©ì „ ê¸°ë¡</h3>
  <table>
    <thead>
      <tr>
        <th>ë‚ ì§œ</th>
        <th>ê¸ˆì•¡</th>
        <th>ì†Œë©¸ ì˜ˆì •ì¼</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="chargeList"></tbody>
  </table>
</div>

</div>

<script>
const gradeStandard = {
  ë¸Œë¡ ì¦ˆ: 100000, ì‹¤ë²„: 300000, ê³¨ë“œ: 600000,
  ë‹¤ì´ì•„: 1000000, ë ˆë“œ: 2000000, ë¸”ë™: 5000000
};

let charges = [];
let targetGrade = null;
const TODAY = new Date();

function addCharge() {
  const d = new Date(chargeDate.value);
  const a = Number(chargeAmount.value);
  if (!d || !a) return alert("ì…ë ¥í•˜ì„¸ìš”!");
  charges.push({date:d, amount:a});
  updateAll();
}

function resetAll() {
  charges = [];
  targetGrade = null;
  updateAll();
}

function setTarget(g) {
  targetGrade = g;
  updateAll();
}

function get13WeekSum(base = TODAY) {
  const limit = new Date(base);
  limit.setDate(limit.getDate() - 91);
  return charges.filter(c=>c.date>=limit && c.date<=base)
                .reduce((s,c)=>s+c.amount,0);
}

function getGrade(sum) {
  return Object.entries(gradeStandard).reverse()
    .find(([g,v])=>sum>=v)?.[0] || "ì—†ìŒ";
}

function updateAll() {
  renderSummary();
  renderChargeList();
  renderSimulation();
  renderRecommend();
}

function renderSummary() {
  const sum = get13WeekSum();
  const grade = getGrade(sum);
  let html = `
    í˜„ì¬ ë“±ê¸‰: <b>${grade}</b><br>
    ìµœê·¼ 13ì£¼ ëˆ„ì : ${sum.toLocaleString()}ì›
  `;
  if (targetGrade) {
    const need = gradeStandard[targetGrade]-sum;
    html += need<=0
      ? `<br>ğŸ‰ ëª©í‘œ ${targetGrade} ë‹¬ì„±`
      : `<br>â— ëª©í‘œê¹Œì§€ ${need.toLocaleString()}ì› í•„ìš”`;
  }
  summary.innerHTML = html;
}

function renderRecommend() {
  if (!targetGrade) {
    recommend.innerHTML = "ëª©í‘œ MVPë¥¼ ì„ íƒí•˜ì„¸ìš”.";
    return;
  }
  const sum = get13WeekSum();
  const need = gradeStandard[targetGrade]-sum;
  if (need<=0) {
    recommend.innerHTML = "ì´ë¯¸ ëª©í‘œ ë‹¬ì„± ìƒíƒœì…ë‹ˆë‹¤ ğŸ‰";
    return;
  }
  const soon = charges
    .map(c=>new Date(c.date.getTime()+91*86400000))
    .sort((a,b)=>a-b)[0];
  if (!soon) {
    recommend.innerHTML = `${need.toLocaleString()}ì› ì¶©ì „ í•„ìš”`;
    return;
  }
  recommend.innerHTML = `
    ğŸ“… ${soon.toISOString().slice(0,10)} ì´ì „<br>
    ğŸ’° ìµœì†Œ ${need.toLocaleString()}ì› ì¶©ì „ ê¶Œì¥
  `;
}

function renderChargeList() {
  chargeList.innerHTML="";
  charges.forEach((c,i)=>{
    const ex = new Date(c.date.getTime()+91*86400000);
    chargeList.innerHTML+=`
      <tr>
        <td>${c.date.toISOString().slice(0,10)}</td>
        <td>${c.amount.toLocaleString()}</td>
        <td>${ex.toISOString().slice(0,10)}</td>
        <td><button onclick="charges.splice(${i},1);updateAll()">ì‚­ì œ</button></td>
      </tr>`;
  });
}

function renderSimulation() {
  simulation.innerHTML="";
  for(let w=0;w<=13;w++){
    const d=new Date(TODAY); d.setDate(d.getDate()+w*7);
    const s=get13WeekSum(d);
    simulation.innerHTML+=`
      <tr>
        <td>${d.toISOString().slice(0,10)}</td>
        <td>${s.toLocaleString()}</td>
        <td>${getGrade(s)}</td>
      </tr>`;
  }
}

themeToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem("theme",document.body.classList.contains("dark"));
};
if(localStorage.getItem("theme")==="true") document.body.classList.add("dark");

updateAll();
</script>

</body>
</html>
