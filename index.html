<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°</title>
<style>
:root{
  --bg:#f5f6f8; --card:#fff; --text:#000;
}
.dark{
  --bg:#121212; --card:#1e1e1e; --text:#fff;
}
body{
  background:var(--bg); color:var(--text);
  font-family:Arial; margin:0;
}
header{
  background:#2563eb; color:#fff;
  padding:14px 20px;
  display:flex; justify-content:space-between;
}
.container{padding:20px;}
.row{display:flex; gap:20px;}
.card{
  background:var(--card); padding:20px;
  border-radius:10px; flex:1;
}
h3{margin-top:0}
table{width:100%; border-collapse:collapse;}
th,td{border-bottom:1px solid #444; padding:6px; text-align:center;}
.btn{padding:6px 10px; border:none; border-radius:6px; cursor:pointer;}
.warn{background:#fff3cd; padding:10px; margin:10px 0;}
.grade-btns button{
  flex:1; padding:10px; margin-right:5px;
  border-radius:6px; border:none; cursor:pointer;
}
.grade-red{background:#ef4444;color:#fff}
.grade-black{background:#000;color:#fff}
.grade-gold{background:#facc15}
.grade-dia{background:#38bdf8}
.grade-silver{background:#9ca3af}
.grade-bronze{background:#a16207}
.badge{padding:3px 8px;border-radius:12px;color:#fff;font-size:12px}
</style>
</head>
<body>

<header>
  <div>ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°</div>
  <button class="btn" onclick="toggleMode()">ğŸŒ™ / â˜€</button>
</header>

<div class="container">

<div class="row">
<div class="card">
<h3>ì¶©ì „ ê¸°ë¡ ì¶”ê°€</h3>
<input type="date" id="date">
<input type="number" id="amount" placeholder="ê¸ˆì•¡">
<br><br>
<button class="btn" onclick="add()">ì¶”ê°€</button>
<button class="btn" onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>

<div class="warn">âš  MVP ê³„ì‚°ì€ ìºì‹œ ì¶©ì „ì¼ì´ ì•„ë‹Œ ì‹¤ì œ ìºì‹œ ì‚¬ìš© ë‚ ì§œ ê¸°ì¤€ì…ë‹ˆë‹¤.</div>

<h4>ì¶©ì „ ê¸°ë¡</h4>
<table id="list"></table>

<div style="height:20px"></div>

<h4>ëª©í‘œ MVP ë“±ê¸‰</h4>
<div class="grade-btns" style="display:flex">
<button class="grade-bronze" onclick="setTarget('ë¸Œë¡ ì¦ˆ')">ë¸Œë¡ ì¦ˆ</button>
<button class="grade-silver" onclick="setTarget('ì‹¤ë²„')">ì‹¤ë²„</button>
<button class="grade-gold" onclick="setTarget('ê³¨ë“œ')">ê³¨ë“œ</button>
<button class="grade-dia" onclick="setTarget('ë‹¤ì´ì•„')">ë‹¤ì´ì•„</button>
<button class="grade-red" onclick="setTarget('ë ˆë“œ')">ë ˆë“œ</button>
<button class="grade-black" onclick="setTarget('ë¸”ë™')">ë¸”ë™</button>
</div>
</div>

<div class="card">
<h3>ğŸ“Œ ìš”ì•½ ì •ë³´</h3>
<div id="summary"></div>
</div>
</div>

<div class="card" style="margin-top:20px">
<h3>ğŸ“Š ì£¼ì°¨ë³„ ì˜ˆìƒ ë“±ê¸‰ ì‹œë®¬ë ˆì´ì…˜ (13ì£¼)</h3>
<table id="weeks"></table>
</div>

</div>

<script>
const grades={
  ë¸Œë¡ ì¦ˆ:150000, ì‹¤ë²„:300000, ê³¨ë“œ:600000,
  ë‹¤ì´ì•„:900000, ë ˆë“œ:1500000, ë¸”ë™:3000000
};
let data=[], target="ë ˆë“œ";

function toggleMode(){
  document.body.classList.toggle("dark");
}

function add(){
  const d=date.value,a=+amount.value;
  if(!d||!a)return;
  data.push({d,a});
  render();
}
function resetAll(){data=[];render();}
function setTarget(g){target=g;render();}

function lastThursday(){
  const d=new Date();
  d.setDate(d.getDate()-((d.getDay()+3)%7));
  d.setHours(0,0,0,0);
  return d;
}

function sumAt(base){
  const from=new Date(base);
  from.setDate(from.getDate()-91);
  return data.filter(x=>{
    const t=new Date(x.d);
    return t>=from && t<=base;
  }).reduce((s,x)=>s+x.a,0);
}

function gradeBy(v){
  let r="ì—†ìŒ";
  for(const g in grades) if(v>=grades[g]) r=g;
  return r;
}

function render(){
  // ê¸°ë¡
  list.innerHTML="<tr><th>ë‚ ì§œ</th><th>ê¸ˆì•¡</th><th>ì‚­ì œ</th></tr>"+
    data.map((x,i)=>`<tr>
    <td>${x.d}</td><td>${x.a.toLocaleString()}</td>
    <td><button onclick="data.splice(${i},1);render()">X</button></td>
    </tr>`).join("");

  // ìš”ì•½
  const base=lastThursday();
  const total=sumAt(base);
  const nowGrade=gradeBy(total);
  const need=grades[target]-total;

  let lastUse=data.length?new Date(Math.max(...data.map(x=>new Date(x.d)))):null;
  let until="";
  if(lastUse){
    lastUse.setDate(lastUse.getDate()+91);
    until=lastUse.toISOString().slice(0,10);
  }

  summary.innerHTML=`
  í˜„ì¬ ë“±ê¸‰: <span class="badge grade-${nowGrade}">${nowGrade}</span><br><br>
  ìµœê·¼ 13ì£¼ ëˆ„ì : ${total.toLocaleString()}ì›<br><br>
  ëª©í‘œ ë“±ê¸‰: <span class="badge grade-${target}">${target}</span><br><br>
  ${need<=0?
    `âœ… ëª©í‘œ ë‹¬ì„±<br>${until}ê¹Œì§€ ìœ ì§€<br>
     ì´í›„ ìœ ì§€ë¥¼ ìœ„í•´ ${grades[target].toLocaleString()}ì› í•„ìš”`
    :
    `âŒ ${need.toLocaleString()}ì› ë” í•„ìš”`
  }
  `;

  // 13ì£¼
  weeks.innerHTML="<tr><th>ê¸°ì¤€ ë‚ ì§œ(ëª©)</th><th>ëˆ„ì </th><th>ë“±ê¸‰</th></tr>";
  for(let i=0;i<13;i++){
    const d=new Date(base);
    d.setDate(d.getDate()+7*i);
    const s=sumAt(d);
    weeks.innerHTML+=`<tr>
      <td>${d.toISOString().slice(0,10)}</td>
      <td>${s.toLocaleString()}</td>
      <td>${gradeBy(s)}</td>
    </tr>`;
  }
}
render();
</script>
</body>
</html>
