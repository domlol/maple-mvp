<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°</title>
<style>
:root {
  --bg: #f5f6f7;
  --card: #ffffff;
  --text: #222;
}
body.dark {
  --bg: #121212;
  --card: #1e1e1e;
  --text: #f1f1f1;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  background: #2563eb;
  color: #fff;
  padding: 14px 20px;
  font-size: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

button {
  cursor: pointer;
}

.container {
  max-width: 1100px;
  margin: 20px auto;
  padding: 0 12px;
}

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.card {
  background: var(--card);
  border-radius: 12px;
  padding: 18px;
}

input {
  padding: 8px 10px;
  font-size: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid #ccc;
  text-align: center;
}

.badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 600;
  color: #fff;
}

.badge-ë¸Œë¡ ì¦ˆ { background:#cd7f32; }
.badge-ì‹¤ë²„ { background:#9ca3af; }
.badge-ê³¨ë“œ { background:#facc15; color:#000; }
.badge-ë‹¤ì´ì•„ { background:#38bdf8; }
.badge-ë ˆë“œ { background:#ef4444; }
.badge-ë¸”ë™ { background:#000; }

.notice {
  margin: 10px 0;
  padding: 8px 12px;
  background: #fff3cd;
  border-left: 4px solid #f59e0b;
  font-size: 13px;
}

.modes {
  background:#fff;
  border-radius:20px;
  padding:4px 8px;
}
</style>
</head>

<body>
<header>
  ë©”ì´í”ŒìŠ¤í† ë¦¬ MVP ê³„ì‚°ê¸°
  <div class="modes">
    <button onclick="toggleMode()">ğŸŒ™ / â˜€ï¸</button>
  </div>
</header>

<div class="container">

<div class="grid">

<div class="card">
  <h3>ì¶©ì „ ê¸°ë¡ ì¶”ê°€</h3>
  <input type="date" id="dateInput">
  <input type="number" id="amountInput" placeholder="ê¸ˆì•¡">
  <button onclick="addRecord()">ì¶”ê°€</button>
  <button onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>

  <div class="notice">âš  MVP ê³„ì‚°ì€ ì‹¤ì œ ìºì‹œ ì‚¬ìš© ë‚ ì§œ ê¸°ì¤€ì…ë‹ˆë‹¤.</div>

  <h4>ì¶©ì „ ê¸°ë¡</h4>
  <table>
    <thead>
      <tr><th>ë‚ ì§œ</th><th>ê¸ˆì•¡</th><th>ì‚­ì œ</th></tr>
    </thead>
    <tbody id="recordTable"></tbody>
  </table>

  <h4>ëª©í‘œ MVP ë“±ê¸‰</h4>
  <div id="targetButtons"></div>
</div>

<div class="card">
  <h3>ğŸ“Œ ìš”ì•½ ì •ë³´</h3>
  <p>í˜„ì¬ ë“±ê¸‰: <span id="currentBadge"></span></p>
  <p>ìµœê·¼ 13ì£¼ ëˆ„ì : <b id="totalText"></b></p>
  <p>ëª©í‘œ ë“±ê¸‰: <span id="targetBadge"></span></p>
  <p id="goalText"></p>
</div>

</div>

<div class="card">
  <h3>ğŸ“Š ì£¼ì°¨ë³„ ì˜ˆìƒ ë“±ê¸‰ ì‹œë®¬ë ˆì´ì…˜ (13ì£¼)</h3>
  <table>
    <thead>
      <tr><th>ê¸°ì¤€ ë‚ ì§œ(ëª©)</th><th>ëˆ„ì </th><th>ë“±ê¸‰</th></tr>
    </thead>
    <tbody id="weekTable"></tbody>
  </table>
</div>

</div>

<script>
const MVP = [
  { name:"ë¸Œë¡ ì¦ˆ", min:150000 },
  { name:"ì‹¤ë²„", min:300000 },
  { name:"ê³¨ë“œ", min:600000 },
  { name:"ë‹¤ì´ì•„", min:900000 },
  { name:"ë ˆë“œ", min:1500000 },
  { name:"ë¸”ë™", min:3000000 }
];

let records = [];
let target = "ë ˆë“œ";

function toggleMode() {
  document.body.classList.toggle("dark");
}

function getLastThursday(base = new Date()) {
  const d = new Date(base);
  const day = d.getDay();
  const diff = (day >= 4) ? day - 4 : day + 3;
  d.setDate(d.getDate() - diff);
  d.setHours(0,0,0,0);
  return d;
}

function gradeByAmount(amount) {
  let g = MVP[0];
  for (const m of MVP) if (amount >= m.min) g = m;
  return g;
}

function addRecord() {
  const d = dateInput.value;
  const a = Number(amountInput.value);
  if (!d || !a) return;
  records.push({ date:d, amount:a });
  update();
}

function resetAll() {
  records = [];
  update();
}

function calc13WeeksTotal(baseDate) {
  const start = new Date(baseDate);
  start.setDate(start.getDate() - 7*12);
  return records.filter(r => {
    const d = new Date(r.date);
    return d >= start && d <= baseDate;
  }).reduce((s,r)=>s+r.amount,0);
}

function calcMaintainAfter(baseDate, targetMin) {
  const start = new Date(baseDate);
  start.setDate(start.getDate() - 7*12);
  const valid = records.filter(r=>{
    const d=new Date(r.date);
    return d>=start && d<=baseDate;
  }).sort((a,b)=>new Date(a.date)-new Date(b.date));
  if (!valid.length) return targetMin;
  const after = valid.reduce((s,r)=>s+r.amount,0) - valid[0].amount;
  return Math.max(0, targetMin - after);
}

function update() {
  recordTable.innerHTML="";
  records.sort((a,b)=>new Date(b.date)-new Date(a.date));
  for (const r of records) {
    recordTable.innerHTML += `<tr>
      <td>${r.date}</td>
      <td>${r.amount.toLocaleString()}</td>
      <td><button onclick="records.splice(${records.indexOf(r)},1);update()">X</button></td>
    </tr>`;
  }

  targetButtons.innerHTML="";
  MVP.forEach(m=>{
    targetButtons.innerHTML+=`<button onclick="target='${m.name}';update()"
    class="badge badge-${m.name}">${m.name}</button> `;
  });

  const base = getLastThursday();
  const total = calc13WeeksTotal(base);
  const cur = gradeByAmount(total);
  const tar = MVP.find(m=>m.name===target);

  currentBadge.innerHTML=`<span class="badge badge-${cur.name}">${cur.name}</span>`;
  targetBadge.innerHTML=`<span class="badge badge-${tar.name}">${tar.name}</span>`;
  totalText.innerText = total.toLocaleString()+"ì›";

  const need = calcMaintainAfter(base, tar.min);
  goalText.innerText = need===0
    ? `${base.toISOString().slice(0,10)}ê¹Œì§€ ìœ ì§€\nì´í›„ ìœ ì§€ë¥¼ ìœ„í•´ 0ì› í•„ìš”`
    : `ì´í›„ ìœ ì§€ë¥¼ ìœ„í•´ ${need.toLocaleString()}ì› í•„ìš”`;

  weekTable.innerHTML="";
  for (let i=0;i<13;i++) {
    const d=new Date(base);
    d.setDate(d.getDate()+7*i);
    const sum=calc13WeeksTotal(d);
    const g=gradeByAmount(sum);
    weekTable.innerHTML+=`<tr>
      <td>${d.toISOString().slice(0,10)}</td>
      <td>${sum.toLocaleString()}</td>
      <td>${g.name}</td>
    </tr>`;
  }
}

update();
</script>
</body>
</html>
